<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Cantonese Read-Aloud â€¢ JoDFun</title>

<style>
:root{
  --bg:#0b1220;
  --bg2:#0f1a33;
  --card:#0f172a;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --primary:#7aa2ff;
  --border:#24314e;
  --radius:16px;
  --tap:44px;
}

/* Light theme */
html[data-theme="light"]{
  --bg:#f7f8fb;
  --bg2:#f3f5ff;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --primary:#6b8cff;
  --border:#e5e7eb;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,var(--bg2),var(--bg));
  color:var(--text);
}

.container{
  max-width:980px;
  margin:0 auto;
  padding:18px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}

.brand{
  display:flex;
  align-items:center;
  gap:14px;
}

.logoWrap{
  width:56px;
  height:56px;
  border-radius:16px;
  background:radial-gradient(circle at 30% 30%, #fff6d1, #ffd166);
  display:grid;
  place-items:center;
  flex-shrink:0;
}

.brand h1{
  margin:0;
  font-size:22px;
  font-weight:800;
}

.brand p{
  margin:6px 0 0;
  font-size:13px;
  color:var(--muted);
}

/* Toggle */
.toggle{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
}

.switch{
  width:50px;
  height:28px;
  border-radius:999px;
  background:rgba(148,163,184,0.25);
  position:relative;
}

.switch::after{
  content:"";
  width:22px;
  height:22px;
  border-radius:50%;
  background:var(--card);
  position:absolute;
  top:3px;
  left:3px;
  transition:left .2s ease;
}

html[data-theme="dark"] .switch::after{ left:25px; }

label{
  font-size:13px;
  font-weight:700;
  color:var(--muted);
}

select, textarea, button, input[type="range"]{
  font-size:15px;
}

select, textarea{
  width:100%;
  border-radius:12px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

select{
  height:var(--tap);
  padding:0 12px;
}

textarea{
  min-height:240px;
  padding:14px;
  line-height:1.6;
  resize:vertical;
  overflow:hidden;
}

.controls{
  display:flex;
  gap:10px;
  margin-top:12px;
}

.btn{
  height:var(--tap);
  padding:0 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:transparent;
  font-weight:800;
  cursor:pointer;
}

.btn.primary{
  background:var(--primary);
  color:#fff;
  border:none;
}

.slider{
  margin-top:12px;
}

.slider label{
  display:flex;
  justify-content:space-between;
}

#progress{
  width:100%;
  margin-top:14px;
}

#reader{
  margin-top:18px;
  padding:12px;
  border-radius:12px;
  border:1px dashed var(--border);
  display:none;
}

.chunk{
  display:block;
  padding:6px 8px;
  border-radius:8px;
}

.chunk.active{
  background:rgba(122,162,255,0.18);
  border-left:4px solid var(--primary);
  padding-left:12px;
}

footer{
  margin-top:26px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
}

footer a{
  color:inherit;
  font-weight:800;
  text-decoration:none;
}
</style>
</head>

<body>
<div class="container">

  <div class="topbar">
    <div class="brand">
      <div class="logoWrap">
        <!-- Capybara SVG -->
        <svg width="36" height="36" viewBox="0 0 128 128">
          <path d="M26 70c0-22 20-38 44-38s44 16 44 38-20 36-44 36S26 92 26 70z" fill="#b78958"/>
          <circle cx="52" cy="62" r="6" fill="#1f2937"/>
          <circle cx="88" cy="62" r="6" fill="#1f2937"/>
          <ellipse cx="70" cy="78" rx="7" ry="5" fill="#3b2a1d"/>
        </svg>
      </div>
      <div>
        <h1>Cantonese Read-Aloud</h1>
        <p>Browser-native Cantonese TTS â€¢ Web Speech API â€¢ Cute capybara-grade professionalism</p>
      </div>
    </div>

    <div class="toggle" id="themeToggle">
      <span>ğŸŒ™</span>
      <div class="switch"></div>
    </div>
  </div>

  <div class="card">

    <label>Voice</label>
    <select id="voice"></select>

    <label style="margin-top:10px;">Text</label>
    <textarea id="text" rows="18">å¾å‰ï¼Œæœ‰ä¸€éš»è¶…ç´š chill å˜… capybaraï¼Œå¤§å®¶éƒ½å«ä½¢ã€Œé˜¿å•¡ã€ã€‚
é˜¿å•¡æœ€é¾æ„åšå˜…äº‹å””ä¿‚æ¸¸æ°´ã€å””ä¿‚é£Ÿè‰â€”â€”
è€Œä¿‚æ‹ä½éƒ¨ iPadï¼Œtab tab tabï¼Œå†åŠ ä¸€éƒ¨ iPhoneï¼Œ100% å°ˆæ³¨æ»‘åˆ°å…¥ç¥ã€‚

æœ‰ä¸€æ—¥ï¼Œé˜¿å•¡ä¸€é‚Šæ…¢æ…¢è¡Œï¼Œä¸€é‚Šç”¨æ‰‹æŒ‡å–º iPad åº¦ç•«ç•«ï¼Œ
ã€Œtabã€tabã€tabã€
ä¸–ç•Œç™¼ç”Ÿä¹œäº‹ï¼Ÿ
å””é‡è¦ã€‚

ä½¢è¡Œå‘€è¡Œï¼Œå®Œå…¨å””çŸ¥è‡ªå·±å…¶å¯¦â€”â€”
è¸©ä½å’—æ¢é±·é­šå€‹é ­ã€‚

é±·é­šå¿ƒè«—ï¼šã€Œå’©æ¨¹ï¼Ÿã€
ä½†é˜¿å•¡å¤ª chillï¼Œè…³æ­¥ç©©å®šï¼Œæƒ…ç·’å¹³ç©©ï¼Œ
é±·é­šåè€Œå””æ•¢éƒã€‚

å†è¡Œå…©æ­¥ï¼Œé˜¿å•¡åˆè¸å’—å–ºä¸€éš»çœ¼é¡è›‡æ¢èƒŒè„Šä¸Šé¢ã€‚
çœ¼é¡è›‡æœ¬ä¾†æƒ³æŠ¬é ­ç¤ºå¨ï¼Œ
ä½†è¦‹åˆ°é˜¿å•¡å…¨ç¨‹ä½é ­æ»‘æ‰‹æ©Ÿï¼Œ
é€£çœ¼ç¥éƒ½å†‡ç•€éï¼Œ
æ¢è›‡çªç„¶è‡ªæˆ‘æ‡·ç–‘ï¼š
ã€Œæˆ‘ä¿‚å’ªå””å¤ å±éšªï¼Ÿã€

ä¹‹å¾Œï¼Œç…å­ã€è€è™ã€ç‹¼ã€ç”šè‡³ä¸€æ¢æš´èºå˜… ï¼Œ
å…¨éƒ¨è®Šæˆå’—ã€Œè¡Œäººè·¯ç£šã€ã€‚
è€Œé˜¿å•¡â€”â€”
åªä¿‚å–ºåº¦ç”¨ iPhone ç‡ç·Šä¸€æ¢å½±ç‰‡ï¼š
ã€Š10 å€‹æ–¹æ³•æ•™ä½ é»æ¨£æ”¾é¬†ã€‹ã€‚

åˆ°æœ€å¾Œï¼Œé˜¿å•¡åœä½ï¼ŒæŠ¬ä¸€æŠ¬é ­ï¼Œ
ç™¼ç¾è‡ªå·±ä¼å–ºä¸€åº§ã€Œç”±å±éšªå‹•ç‰©ç Œæˆå˜…å±±ã€ä¸Šé¢ã€‚
ä½¢çœ¨ä¸€çœ¨çœ¼ï¼Œ
å†ä½é ­ï¼Œç¹¼çºŒ tab tab tabã€‚

å› ç‚ºå°é˜¿å•¡åšŸè¬›â€”â€”
ä¸–ç•Œå†å±éšªï¼Œéƒ½æ•µå””éä¸€éš»å°ˆå¿ƒåˆ chill å˜… capybaraã€‚</textarea>

    <div class="slider">
      <label>Speed <span id="rateLabel">1.00Ã—</span></label>
      <input id="rate" type="range" min="0.5" max="1.5" step="0.05" value="1">
    </div>

    <div class="slider">
      <label>Pitch <span id="pitchLabel">1.00</span></label>
      <input id="pitch" type="range" min="0" max="2" step="0.05" value="1">
    </div>

    <input id="progress" type="range" min="0" max="100" value="0" disabled>

    <div class="controls">
      <button class="btn primary" id="playPause">â–¶ Speak</button>
      <button class="btn" id="stop">â–  Stop</button>
    </div>

    <div id="reader"></div>
  </div>

  <footer>
    Â© 2025 <strong>JoDFun Inc.</strong><br/>
    Designed and implemented by JoDFun Inc.<br/>
    Collaboration: <a href="mailto:gideont@gmail.com">gideont@gmail.com</a>
  </footer>

</div>

<script>
/* Default dark mode */
document.documentElement.setAttribute('data-theme','dark');

const synth = speechSynthesis;
const voiceSel = document.getElementById('voice');
const textEl = document.getElementById('text');
const reader = document.getElementById('reader');
const progress = document.getElementById('progress');
const playPauseBtn = document.getElementById('playPause');

const rate = document.getElementById('rate');
const pitch = document.getElementById('pitch');
const rateLabel = document.getElementById('rateLabel');
const pitchLabel = document.getElementById('pitchLabel');

let chunks = [];
let index = 0;
let speaking = false;
let paused = false;

/* Auto-expand textarea */
function autoResize(){
  textEl.style.height = 'auto';
  textEl.style.height = textEl.scrollHeight + 'px';
}
textEl.addEventListener('input', autoResize);

/* Voices */
function loadVoices(){
  voiceSel.innerHTML = '';
  synth.getVoices().forEach(v=>{
    const o=document.createElement('option');
    o.value=v.name;
    o.textContent=`${v.name} â€” ${v.lang}`;
    voiceSel.appendChild(o);
  });

  const cantonese=[...voiceSel.options].find(o=>/yue|ç²µ|cantonese|zh-hk/i.test(o.text));
  if(cantonese) voiceSel.value=cantonese.value;
}

/* Build paragraphs */
function buildChunks(){
  reader.innerHTML='';
  chunks = textEl.value
    .split(/\n\s*\n/)
    .map(t=>t.trim())
    .filter(Boolean)
    .map(t=>{
      const s=document.createElement('span');
      s.className='chunk';
      s.textContent=t;
      reader.appendChild(s);
      return s;
    });

  reader.style.display = chunks.length ? 'block':'none';
  progress.disabled = !chunks.length;
}

/* Highlight */
function highlight(i){
  chunks.forEach((c,idx)=>c.classList.toggle('active',idx===i));
}

/* Speak logic */
function speakFrom(i){
  if(!chunks.length) return;
  synth.cancel();
  index=i;
  speaking=true;
  paused=false;
  playPauseBtn.textContent='â¸ Pause';
  speakNext();
}

function speakNext(){
  if(!speaking || index>=chunks.length){
    speaking=false;
    paused=false;
    playPauseBtn.textContent='â–¶ Speak';
    return;
  }

  highlight(index);
  progress.value = Math.floor(index / chunks.length * 100);

  const u=new SpeechSynthesisUtterance(chunks[index].textContent);
  const v=synth.getVoices().find(v=>v.name===voiceSel.value);
  if(v) u.voice=v;

  u.rate=+rate.value;
  u.pitch=+pitch.value;

  u.onend=()=>{
    index++;
    speakNext();
  };

  synth.speak(u);
}

/* Play / Pause / Resume */
playPauseBtn.onclick=()=>{
  if(!speaking){
    buildChunks();
    speakFrom(Math.floor(progress.value/100*chunks.length)||0);
    return;
  }

  if(speaking && !paused){
    synth.pause();
    paused=true;
    playPauseBtn.textContent='âµ Resume';
    return;
  }

  if(paused){
    paused=false;
    synth.cancel();
    speakFrom(index); // restart paragraph with new speed/pitch
  }
};

/* Stop = hard reset */
document.getElementById('stop').onclick=()=>{
  synth.cancel();
  speaking=false;
  paused=false;
  index=0;
  progress.value=0;
  chunks.forEach(c=>c.classList.remove('active'));
  playPauseBtn.textContent='â–¶ Speak';
};

/* Seek */
progress.addEventListener('input',e=>{
  if(!chunks.length) return;
  speakFrom(Math.floor(e.target.value/100*chunks.length));
});

/* Sliders */
rate.oninput=()=>rateLabel.textContent=`${(+rate.value).toFixed(2)}Ã—`;
pitch.oninput=()=>pitchLabel.textContent=`${(+pitch.value).toFixed(2)}`;

/* Theme toggle */
document.getElementById('themeToggle').onclick=()=>{
  document.documentElement.setAttribute(
    'data-theme',
    document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark'
  );
};

/* Init */
if('onvoiceschanged' in synth) synth.onvoiceschanged=loadVoices;
loadVoices();
</script>
</body>
</html>
